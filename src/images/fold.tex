\input{_header.tex}

\matrix (A) [collection, name prefix=a] {
    \node (1) {$a_1$}; &
    \node (2) {$a_2$}; &
    \ellipsis          &
    \node (i) {$a_i$}; &
    \ellipsis          &
    \node (n) {$a_n$}; \\
};

\node (z) [elem, left=5mm of a1] {$z$};
\node (f1) [below=15mm of a2] {$f(z, a_2)$};
\node (f2) [below=25mm of an] {$f(z_1, a_n)$};
\node (f3) [below=35mm of a1] {$f(z_2, a_1)$};
\node (fn) [below=45mm of ai] {$f(z_{n-1}, a_i)$};

\node (B) [elem, below=10mm of fn] {$b$};

% \foreach \i/\z [count=\c] in {1/z,2/z_1,i/z_{i-1},n/z_{n-1}} {
%   \node (f\i) [below of=a\i, node distance={1cm + \c * 1cm}, xshift=-1em] {$f(\z, a_{\i})$};
%   \draw (a\i) [arrow] to (a\i |- f\i.north);
% }
% 
% \node (B) [elem, below of=fn, node distance=1.5cm] {$b$};
% 

\begin{scope}
  \tikzstyle{every path}=[arrow]
  \draw [white border, out=270, in=90] (z.south) to (f1.110);
  \draw [white border, out=270, in=90] (a2.south) to (f1.45);

  \draw [white border, out=270, in=90] (an.south) to (f2.45);
  \draw [white border, out=0, in=90] (f1.east) to (f2.120);

  \draw [white border, out=270, in=90] (a1.south) to (f3.45);
  \draw [white border, out=180, in=90] (f2.west) to (f3.120);

  \draw [white border, out=270, in=90] (ai.south) to (fn.30);
  \draw [white border, out=0, in=90] (f3.east) [middotted] to (fn.120);

  \draw (fn.south) -- (B.north);
\end{scope}

\input{_footer.tex}
